<section *ngIf="showFilters">
  <div class="row align-items-center p-2 border">
    <div class="col-sm-8 col-md-10 mb-2 mb-sm-0">
      <input
        type="search"
        (keyup)="textSearch($event)"
        class="form-control shadow-0"
        placeholder="Search"
      />
    </div>
    <div class="col-sm-4 col-md-2">
      <button
        class="btn btn-outlined_sm border-secondary text-secondary"
        (click)="cancelFilterUpdate()"
      >
        cancel
      </button>
      <button class="btn btn-outlined_sm ms-3" (click)="saveFilterUpdate()">
        save
      </button>
    </div>
  </div>
  <mat-chip-set class="ms-3">
    <ng-container *ngFor="let filter of objectvalues(appliedFilters)">
      <app-chip-selectbox
        [label]="filter['label']"
        [options]="filter['data']"
        [type]="filter['type']"
        [multiple]="filter['multiple'] ?? false"
        (selectionChange)="onUpdateFilter($event, filter)"
      ></app-chip-selectbox>
    </ng-container>
    <mat-chip [matMenuTriggerFor]="menu">
      <mat-icon matChipTrailingIcon>add</mat-icon>
      Add filter
    </mat-chip>
    <button mat-button class="ms-2" (click)="clearAll()">Clear All</button>
  </mat-chip-set>

  <mat-menu #menu="matMenu">
    <ng-container *ngFor="let filter of objectvalues(filterData ?? {})">
      <button mat-menu-item (click)="addFilter(filter)">
        {{ filter['label'] }}
      </button>
    </ng-container>
  </mat-menu>
</section>

<div
  class="d-flex border border-bottom-0"
  [ngClass]="{ 'd-none': showFilters }"
>
  <nav class="nav fs-14">
    <ng-container *ngFor="let tab of availableTabs; let i = index">
      <div class="nav-item dropdown">
        <button
          #tabRef
          tabindex="-1"
          class="nav-link"
          data-bs-toggle="dropdown"
          [disabled]="editViewMode.editMode"
          [ngClass]="{
            'active dropdown-toggle':
              selectedTab && selectedTab['name'] === tab['name']
          }"
          (click)="onTabClick(tab, tabRef, i)"
          (keyup)="onTabClick(tab, tabRef, i)"
        >
          {{ tab['name'] }}
        </button>
        <ul class="dropdown-menu">
          <li *ngIf="tab['name'] !== 'All'">
            <button class="dropdown-item" (click)="updateName(i, 'rename')">
              Rename view
            </button>
          </li>
          <li *ngIf="tab['name'] !== 'All'">
            <button class="dropdown-item" (click)="updateName(i, 'duplicate')">
              Duplicate view
            </button>
          </li>
          <li>
            <button class="dropdown-item" (click)="onClickEditView(i)">
              Edit view
            </button>
          </li>
          <li *ngIf="tab['name'] !== 'All'">
            <button
              class="dropdown-item text-danger"
              (click)="updateName(i, 'delete')"
            >
              Delete view
            </button>
          </li>
        </ul>
      </div>
    </ng-container>
    <div class="nav-item">
      <button class="nav-link" (click)="updateName(-1, 'create new view')">
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </nav>

  <div class="nav ms-auto">
    <button class="nav-link" (click)="showHideFilters()">
      <mat-icon>search</mat-icon>
      <mat-icon>filter_list</mat-icon>
    </button>
    <button class="nav-link">
      <mat-icon>sort</mat-icon>
    </button>
  </div>
  <div class="nav ms-auto me-2" *ngIf="editViewMode.editMode">
    <button class="nav-link" (click)="cancelEditView()">cancel</button>
    <button class="nav-link ms-2 text-primary" (click)="saveEditView()">
      save
    </button>
  </div>
</div>

<ng-content></ng-content>

<ng-template #updateNameTemplate let-data>
  <h1
    mat-dialog-title
    class="h2 d-flex align-items-center pb-0 bg-secondary-subtle text-capitalize"
  >
    {{ data.context }}
    <span role="button" mat-dialog-close class="btn-close ms-auto"></span>
  </h1>
  <div mat-dialog-content class="pb-0">
    <div class="mb-3" *ngIf="!['delete'].includes(data.context)">
      <label for="name" class="form-label">Name</label>
      <input
        type="text"
        [(ngModel)]="data.tab.name"
        class="form-control"
        autocomplete="new-password"
        id="name"
      />
    </div>
    <div class="my-3" *ngIf="['delete'].includes(data.context)">
      This canâ€™t be undone. {{ data.tab.name }} view will no longer be available
      in your admin.
    </div>
  </div>
  <div mat-dialog-actions>
    <button mat-button class="ms-auto" mat-dialog-close>Cancel</button>
    <button
      mat-button
      [mat-dialog-close]="data.tab"
      *ngIf="!['delete'].includes(data.context)"
    >
      Save
    </button>
    <button
      mat-button
      mat-dialog-close="delete"
      *ngIf="['delete'].includes(data.context)"
      class="text-white bg-danger"
    >
      Delete
    </button>
  </div>
</ng-template>
